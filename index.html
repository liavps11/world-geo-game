<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>World Geography Quiz - Corrected Borders</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Arial', sans-serif; overflow: hidden; background-color: #87CEEB; }
        #map { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; }
        #ui-container {
            position: absolute; top: 0; left: 0; right: 0; z-index: 1000;
            background: linear-gradient(to bottom, rgba(52, 73, 94, 0.95), rgba(44, 62, 80, 0.95));
            padding: 8px 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            display: flex; align-items: center; justify-content: center; height: 70px;
        }
        #score-corner {
            position: absolute; left: 15px; top: 50%; transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.3); padding: 6px 12px; border-radius: 15px;
            font-size: 13px; color: white; font-weight: bold;
        }
        #question-container { display: flex; align-items: center; gap: 12px; cursor: pointer; }
        #country-name {
            font-size: 22px; color: white; font-weight: bold; background: rgba(255, 255, 255, 0.15);
            padding: 6px 16px; border-radius: 6px; border: 2px solid rgba(255, 255, 255, 0.25);
        }
        #on-screen-feedback {
            position: absolute; z-index: 1500; font-size: 14px; font-weight: bold; color: white;
            background: rgba(0, 0, 0, 0.85); padding: 6px 12px; border-radius: 6px;
            pointer-events: none; opacity: 0; transition: opacity 0.2s ease;
        }
        #on-screen-feedback.show { opacity: 1 !important; }
        .region-path { cursor: pointer; transition: all 0.1s ease; }
    </style>
</head>
<body>
    <div id="map"></div>
    <div id="ui-container">
        <div id="score-corner">Score: <span id="score-value">0</span></div>
        <div id="question-container">
            <span style="color:white">Click on</span>
            <span id="country-name">START GAME</span>
        </div>
    </div>
    <div id="on-screen-feedback"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        let gameState = { started: false, currentQuestion: null, score: 0, regions: [], remainingRegions: [] };
        let map; let regionLayers = {};

        // Manual coordinates to define Western Sahara separately
        const westernSaharaGeo = {
            "type": "Polygon",
            "coordinates": [[[-13.1, 27.6], [-8.6, 27.6], [-8.6, 21.3], [-17.1, 21.3], [-17.1, 22.2], [-13.1, 27.6]]]
        };

        const extraIslands = [
            { name: 'Seychelles', lat: -4.67, lng: 55.49 },
            { name: 'Mauritius', lat: -20.34, lng: 57.55 },
            { name: 'Comoros', lat: -11.64, lng: 43.33 }
        ];

        function applyHighlight(layer) {
            layer.on('mouseover', function() {
                this.setStyle({ fillOpacity: 0.5, weight: 3, color: 'white', fillColor: '#FFEB3B' });
            });
            layer.on('mouseout', function() {
                this.setStyle({ fillOpacity: 1, weight: 1, color: 'white', fillColor: '#4CAF50' });
            });
        }

        async function init() {
            map = L.map('map', { attributionControl: false, minZoom: 2 }).setView([20, 0], 2);
            const res = await fetch('https://raw.githubusercontent.com/johan/world.geo.json/master/countries.geo.json');
            const data = await res.json();
            
            data.features.forEach(f => {
                let name = f.properties.name;
                if (name === 'Swaziland') name = 'Eswatini';
                
                // If it's the combined Morocco/Western Sahara shape, we label it just Morocco
                // and we will add the separate Western Sahara shape later.
                if (name === 'Morocco') {
                    // Logic to adjust Morocco's display if needed can go here
                }

                if (name !== 'United States' && name !== 'Somaliland' && name !== 'Western Sahara') {
                    const l = L.geoJSON(f, { style: { fillColor: '#4CAF50', fillOpacity: 1, color: 'white', weight: 1 } }).addTo(map);
                    regionLayers[name] = l;
                    gameState.regions.push({ name });
                    applyHighlight(l);
                    l.on('click', e => handleRegionClick(name, e));
                }
            });

            // MANUALLY ADD WESTERN SAHARA
            const wsLayer = L.geoJSON({
                "type": "Feature",
                "properties": { "name": "Western Sahara" },
                "geometry": westernSaharaGeo
            }, { style: { fillColor: '#4CAF50', fillOpacity: 1, color: 'white', weight: 1 } }).addTo(map);
            regionLayers["Western Sahara"] = wsLayer;
            gameState.regions.push({ name: "Western Sahara" });
            applyHighlight(wsLayer);
            wsLayer.on('click', e => handleRegionClick("Western Sahara", e));

            // ADD ISLANDS
            extraIslands.forEach(c => {
                const m = L.circleMarker([c.lat, c.lng], { radius: 6, fillColor: '#4CAF50', color: 'white', weight: 2, fillOpacity: 1 }).addTo(map);
                regionLayers[c.name] = m;
                gameState.regions.push({ name: c.name });
                m.on('mouseover', function() { this.setStyle({ fillColor: '#FFEB3B', radius: 9 }); });
                m.on('mouseout', function() { this.setStyle({ fillColor: '#4CAF50', radius: 6 }); });
                m.on('click', e => handleRegionClick(c.name, e));
            });
        }

        function handleRegionClick(name, e) {
            if (!gameState.started) return;
            const pt = map.mouseEventToContainerPoint(e.originalEvent);
            if (name === gameState.currentQuestion.name) {
                gameState.score += 1;
                document.getElementById('score-value').textContent = gameState.score;
                nextQuestion();
            } else {
                const fb = document.getElementById('on-screen-feedback');
                fb.textContent = name; fb.style.left = pt.x + "px"; fb.style.top = pt.y + "px";
                fb.classList.add('show'); setTimeout(() => fb.classList.remove('show'), 1500);
            }
        }

        function nextQuestion() {
            if (gameState.remainingRegions.length === 0) {
                document.getElementById('country-name').textContent = "WINNER!";
                return;
            }
            const idx = Math.floor(Math.random() * gameState.remainingRegions.length);
            gameState.currentQuestion = gameState.remainingRegions.splice(idx, 1)[0];
            document.getElementById('country-name').textContent = gameState.currentQuestion.name;
        }

        document.getElementById('question-container').onclick = () => {
            if(!gameState.started) {
                gameState.started = true;
                gameState.remainingRegions = [...gameState.regions];
                nextQuestion();
            }
        };

        window.onload = init;
    </script>
</body>
</html>
