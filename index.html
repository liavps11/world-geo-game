<!DOCTYPE html>
<html lang="en">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>World Geography Quiz - Seterra Style</title>
Â  Â  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
Â  Â  <style>
Â  Â  Â  Â  * {
Â  Â  Â  Â  Â  Â  margin: 0;
Â  Â  Â  Â  Â  Â  padding: 0;
Â  Â  Â  Â  Â  Â  box-sizing: border-box;
Â  Â  Â  Â  }

Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  font-family: 'Arial', sans-serif;
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  Â  Â  background-color: #87CEEB;
Â  Â  Â  Â  }

Â  Â  Â  Â  #map {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  top: 0;
Â  Â  Â  Â  Â  Â  left: 0;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  Â  Â  z-index: 1;
Â  Â  Â  Â  }

Â  Â  Â  Â  #ui-container {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  top: 0;
Â  Â  Â  Â  Â  Â  left: 0;
Â  Â  Â  Â  Â  Â  right: 0;
Â  Â  Â  Â  Â  Â  z-index: 1000;
Â  Â  Â  Â  Â  Â  background: linear-gradient(to bottom, rgba(52, 73, 94, 0.95), rgba(44, 62, 80, 0.95));
Â  Â  Â  Â  Â  Â  padding: 8px 20px;
Â  Â  Â  Â  Â  Â  box-shadow: 0 2px 8px rgba(0,0,0,0.3);
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  height: 70px;
Â  Â  Â  Â  }

Â  Â  Â  Â  #score-corner {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  left: 15px;
Â  Â  Â  Â  Â  Â  top: 50%;
Â  Â  Â  Â  Â  Â  transform: translateY(-50%);
Â  Â  Â  Â  Â  Â  background: rgba(0, 0, 0, 0.3);
Â  Â  Â  Â  Â  Â  padding: 6px 12px;
Â  Â  Â  Â  Â  Â  border-radius: 15px;
Â  Â  Â  Â  Â  Â  font-size: 13px;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  }

Â  Â  Â  Â  #question-container {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  gap: 12px;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  }

Â  Â  Â  Â  #click-on-text {
Â  Â  Â  Â  Â  Â  font-size: 18px;
Â  Â  Â  Â  Â  Â  color: rgba(255, 255, 255, 0.9);
Â  Â  Â  Â  Â  Â  font-weight: normal;
Â  Â  Â  Â  }

Â  Â  Â  Â  #country-name {
Â  Â  Â  Â  Â  Â  font-size: 22px;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  background: rgba(255, 255, 255, 0.15);
Â  Â  Â  Â  Â  Â  padding: 6px 16px;
Â  Â  Â  Â  Â  Â  border-radius: 6px;
Â  Â  Â  Â  Â  Â  border: 2px solid rgba(255, 255, 255, 0.25);
Â  Â  Â  Â  }

Â  Â  Â  Â  #country-flag {
Â  Â  Â  Â  Â  Â  height: 60px;
Â  Â  Â  Â  Â  Â  width: auto;
Â  Â  Â  Â  Â  Â  max-width: 100px;
Â  Â  Â  Â  Â  Â  border: 2px solid white;
Â  Â  Â  Â  Â  Â  border-radius: 3px;
Â  Â  Â  Â  Â  Â  box-shadow: 0 2px 4px rgba(0,0,0,0.3);
Â  Â  Â  Â  Â  Â  object-fit: contain;
Â  Â  Â  Â  }

Â  Â  Â  Â  #on-screen-feedback {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  z-index: 1500;
Â  Â  Â  Â  Â  Â  font-size: 14px;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  background: rgba(0, 0, 0, 0.85);
Â  Â  Â  Â  Â  Â  padding: 6px 12px;
Â  Â  Â  Â  Â  Â  border-radius: 6px;
Â  Â  Â  Â  Â  Â  pointer-events: none;
Â  Â  Â  Â  Â  Â  opacity: 0;
Â  Â  Â  Â  Â  Â  transition: opacity 0.2s ease;
Â  Â  Â  Â  Â  Â  box-shadow: 0 2px 8px rgba(0,0,0,0.5);
Â  Â  Â  Â  Â  Â  border: 1px solid rgba(255,255,255,0.3);
Â  Â  Â  Â  }

Â  Â  Â  Â  #on-screen-feedback.show {
Â  Â  Â  Â  Â  Â  opacity: 1 !important;
Â  Â  Â  Â  }

Â  Â  Â  Â  #completion-screen {
Â  Â  Â  Â  Â  Â  display: none;
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  top: 50%;
Â  Â  Â  Â  Â  Â  left: 50%;
Â  Â  Â  Â  Â  Â  transform: translate(-50%, -50%);
Â  Â  Â  Â  Â  Â  z-index: 2000;
Â  Â  Â  Â  Â  Â  background: white;
Â  Â  Â  Â  Â  Â  padding: 40px;
Â  Â  Â  Â  Â  Â  border-radius: 15px;
Â  Â  Â  Â  Â  Â  box-shadow: 0 8px 16px rgba(0,0,0,0.4);
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  }

Â  Â  Â  Â  #completion-screen h2 {
Â  Â  Â  Â  Â  Â  color: #4CAF50;
Â  Â  Â  Â  Â  Â  margin-bottom: 20px;
Â  Â  Â  Â  }

Â  Â  Â  Â  #completion-screen p {
Â  Â  Â  Â  Â  Â  font-size: 18px;
Â  Â  Â  Â  Â  Â  margin-bottom: 10px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .leaflet-container {
Â  Â  Â  Â  Â  Â  background-color: #87CEEB !important;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Country hover transparency effect */
Â  Â  Â  Â  .region-path {
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  transition: fill-opacity 0.1s ease, stroke-width 0.1s ease !important;
Â  Â  Â  Â  }

Â  Â  Â  Â  .region-path:hover {
Â  Â  Â  Â  Â  Â  fill-opacity: 0.5 !important;
Â  Â  Â  Â  Â  Â  stroke: white !important;
Â  Â  Â  Â  Â  Â  stroke-width: 2px !important;
Â  Â  Â  Â  }

Â  Â  Â  Â  .small-country-dot {
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  transition: fill-opacity 0.1s ease !important;
Â  Â  Â  Â  }

Â  Â  Â  Â  .small-country-dot:hover {
Â  Â  Â  Â  Â  Â  fill-opacity: 0.5 !important;
Â  Â  Â  Â  }

Â  Â  Â  Â  @keyframes flash-white {
Â  Â  Â  Â  Â  Â  0%, 100% { }
Â  Â  Â  Â  Â  Â  50% { fill: white !important; fill-opacity: 1 !important; }
Â  Â  Â  Â  }

Â  Â  Â  Â  @keyframes flash-yellow {
Â  Â  Â  Â  Â  Â  0%, 100% { }
Â  Â  Â  Â  Â  Â  50% { fill: #FFEB3B !important; fill-opacity: 1 !important; }
Â  Â  Â  Â  }

Â  Â  Â  Â  @keyframes flash-orange {
Â  Â  Â  Â  Â  Â  0%, 100% { }
Â  Â  Â  Â  Â  Â  50% { fill: #FF9800 !important; fill-opacity: 1 !important; }
Â  Â  Â  Â  }

Â  Â  Â  Â  @keyframes flash-red {
Â  Â  Â  Â  Â  Â  0%, 100% { }
Â  Â  Â  Â  Â  Â  50% { fill: #f44336 !important; fill-opacity: 1 !important; }
Â  Â  Â  Â  }

Â  Â  Â  Â  @keyframes pulse-red {
Â  Â  Â  Â  Â  Â  0%, 100% { fill-opacity: 1; }
Â  Â  Â  Â  Â  Â  50% { fill: #f44336 !important; fill-opacity: 0.6 !important; }
Â  Â  Â  Â  }

Â  Â  Â  Â  .flash-white {
Â  Â  Â  Â  Â  Â  animation: flash-white 0.5s !important;
Â  Â  Â  Â  }

Â  Â  Â  Â  .flash-yellow {
Â  Â  Â  Â  Â  Â  animation: flash-yellow 0.5s !important;
Â  Â  Â  Â  }

Â  Â  Â  Â  .flash-orange {
Â  Â  Â  Â  Â  Â  animation: flash-orange 0.5s !important;
Â  Â  Â  Â  }

Â  Â  Â  Â  .flash-red {
Â  Â  Â  Â  Â  Â  animation: flash-red 0.5s !important;
Â  Â  Â  Â  }

Â  Â  Â  Â  .pulse-red-continuous {
Â  Â  Â  Â  Â  Â  animation: pulse-red 1s infinite !important;
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body>
Â  Â  <div id="map"></div>
Â  Â Â 
Â  Â  <div id="ui-container">
Â  Â  Â  Â  <div id="score-corner">
Â  Â  Â  Â  Â  Â  <span id="score-value">0</span> / <span id="total-regions">0</span>
Â  Â  Â  Â  </div>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <div id="question-container">
Â  Â  Â  Â  Â  Â  <span id="click-on-text">Click on</span>
Â  Â  Â  Â  Â  Â  <span id="country-name">START GAME</span>
Â  Â  Â  Â  Â  Â  <img id="country-flag" src="" alt="" style="display: none;">
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="on-screen-feedback"></div>

Â  Â  <div id="completion-screen">
Â  Â  Â  Â  <h2>Quiz Complete! ðŸŽ‰</h2>
Â  Â  Â  Â  <p>Final Score: <span id="final-score"></span></p>
Â  Â  Â  Â  <p>Accuracy: <span id="accuracy"></span></p>
Â  Â  Â  Â  <button id="restart-button" style="background-color: #4CAF50; color: white; border: none; padding: 15px 30px; font-size: 18px; border-radius: 5px; cursor: pointer; margin-top: 20px;">Play Again</button>
Â  Â  </div>

Â  Â  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
Â  Â  <script>
Â  Â  Â  Â  // Game state
Â  Â  Â  Â  let gameState = {
Â  Â  Â  Â  Â  Â  started: false,
Â  Â  Â  Â  Â  Â  currentQuestion: null,
Â  Â  Â  Â  Â  Â  score: 0,
Â  Â  Â  Â  Â  Â  totalQuestions: 0,
Â  Â  Â  Â  Â  Â  attempts: 0,
Â  Â  Â  Â  Â  Â  regions: [],
Â  Â  Â  Â  Â  Â  remainingRegions: [],
Â  Â  Â  Â  Â  Â  correctAnswers: 0,
Â  Â  Â  Â  Â  Â  totalAttempts: 0,
Â  Â  Â  Â  Â  Â  processing: false,
Â  Â  Â  Â  Â  Â  pulsingLayer: null
Â  Â  Â  Â  };

Â  Â  Â  Â  let map;
Â  Â  Â  Â  let regionLayers = {};
Â  Â  Â  Â  let smallCountryMarkers = {};

Â  Â  Â  Â  // VERY small countries that need dots (not visible as outlines)
Â  Â  Â  Â  const smallCountries = [
Â  Â  Â  Â  Â  Â  { name: 'Vatican City', lat: 41.9029, lng: 12.4534 },
Â  Â  Â  Â  Â  Â  { name: 'San Marino', lat: 43.9424, lng: 12.4578 },
Â  Â  Â  Â  Â  Â  { name: 'Monaco', lat: 43.7384, lng: 7.4246 },
Â  Â  Â  Â  Â  Â  { name: 'Liechtenstein', lat: 47.1660, lng: 9.5554 },
Â  Â  Â  Â  Â  Â  { name: 'Andorra', lat: 42.5063, lng: 1.5218 },
Â  Â  Â  Â  Â  Â  { name: 'Singapore', lat: 1.3521, lng: 103.8198 },
Â  Â  Â  Â  Â  Â  { name: 'Bahrain', lat: 26.0667, lng: 50.5577 },
Â  Â  Â  Â  Â  Â  { name: 'Maldives', lat: 3.2028, lng: 73.2207 },
Â  Â  Â  Â  Â  Â  { name: 'Barbados', lat: 13.1939, lng: -59.5432 },
Â  Â  Â  Â  Â  Â  { name: 'Antigua and Barbuda', lat: 17.0608, lng: -61.7964 },
Â  Â  Â  Â  Â  Â  { name: 'Saint Lucia', lat: 13.9094, lng: -60.9789 },
Â  Â  Â  Â  Â  Â  { name: 'Grenada', lat: 12.1165, lng: -61.6790 },
Â  Â  Â  Â  Â  Â  { name: 'Saint Vincent and the Grenadines', lat: 12.9843, lng: -61.2872 },
Â  Â  Â  Â  Â  Â  { name: 'Dominica', lat: 15.4150, lng: -61.3710 },
Â  Â  Â  Â  Â  Â  { name: 'Saint Kitts and Nevis', lat: 17.3578, lng: -62.7830 },
Â  Â  Â  Â  Â  Â  { name: 'Somaliland', lat: 9.5, lng: 44.0 }
Â  Â  Â  Â  ];

Â  Â  Â  Â  // Territories
Â  Â  Â  Â  const territories = [
Â  Â  Â  Â  Â  Â  { name: 'Puerto Rico', lat: 18.2208, lng: -66.5901 },
Â  Â  Â  Â  Â  Â  { name: 'Greenland', lat: 71.7069, lng: -42.6043 },
Â  Â  Â  Â  Â  Â  { name: 'French Guiana', lat: 3.9339, lng: -53.1258 },
Â  Â  Â  Â  Â  Â  { name: 'New Caledonia', lat: -20.9043, lng: 165.6180 },
Â  Â  Â  Â  Â  Â  { name: 'French Polynesia', lat: -17.6797, lng: -149.4068 },
Â  Â  Â  Â  Â  Â  { name: 'Guam', lat: 13.4443, lng: 144.7937 },
Â  Â  Â  Â  Â  Â  { name: 'Northern Mariana Islands', lat: 15.0979, lng: 145.6739 },
Â  Â  Â  Â  Â  Â  { name: 'American Samoa', lat: -14.2710, lng: -170.1322 },
Â  Â  Â  Â  Â  Â  { name: 'U.S. Virgin Islands', lat: 18.3358, lng: -64.8963 },
Â  Â  Â  Â  Â  Â  { name: 'British Virgin Islands', lat: 18.4207, lng: -64.6400 },
Â  Â  Â  Â  Â  Â  { name: 'Cayman Islands', lat: 19.3133, lng: -81.2546 },
Â  Â  Â  Â  Â  Â  { name: 'Bermuda', lat: 32.3078, lng: -64.7505 },
Â  Â  Â  Â  Â  Â  { name: 'Turks and Caicos Islands', lat: 21.6940, lng: -71.7979 },
Â  Â  Â  Â  Â  Â  { name: 'Aruba', lat: 12.5211, lng: -69.9683 },
Â  Â  Â  Â  Â  Â  { name: 'CuraÃ§ao', lat: 12.1696, lng: -68.9900 },
Â  Â  Â  Â  Â  Â  { name: 'Falkland Islands', lat: -51.7963, lng: -59.5236 },
Â  Â  Â  Â  Â  Â  { name: 'Gibraltar', lat: 36.1408, lng: -5.3536 },
Â  Â  Â  Â  Â  Â  { name: 'Faroe Islands', lat: 61.8926, lng: -6.9118 },
Â  Â  Â  Â  Â  Â  { name: 'Ã…land Islands', lat: 60.1785, lng: 19.9156 },
Â  Â  Â  Â  Â  Â  { name: 'Svalbard', lat: 77.8750, lng: 20.9752 },
Â  Â  Â  Â  Â  Â  { name: 'Isle of Man', lat: 54.2361, lng: -4.5481 },
Â  Â  Â  Â  Â  Â  { name: 'Guernsey', lat: 49.4657, lng: -2.5853 },
Â  Â  Â  Â  Â  Â  { name: 'Jersey', lat: 49.2144, lng: -2.1312 },
Â  Â  Â  Â  Â  Â  { name: 'Western Sahara', lat: 24.2155, lng: -12.8858 },
Â  Â  Â  Â  Â  Â  { name: 'Palestine', lat: 31.9522, lng: 35.2332 },
Â  Â  Â  Â  Â  Â  { name: 'Hong Kong', lat: 22.3193, lng: 114.1694 },
Â  Â  Â  Â  Â  Â  { name: 'Macau', lat: 22.1987, lng: 113.5439 }
Â  Â  Â  Â  ];

Â  Â  Â  Â  // US State flags
Â  Â  Â  Â  const stateFlags = {
Â  Â  Â  Â  Â  Â  'Alabama': 'https://upload.wikimedia.org/wikipedia/commons/thumb/5/5c/Flag_of_Alabama.svg/120px-Flag_of_Alabama.svg.png',
Â  Â  Â  Â  Â  Â  'Alaska': 'https://upload.wikimedia.org/wikipedia/commons/thumb/e/e6/Flag_of_Alaska.svg/120px-Flag_of_Alaska.svg.png',
Â  Â  Â  Â  Â  Â  'Arizona': 'https://upload.wikimedia.org/wikipedia/commons/thumb/9/9d/Flag_of_Arizona.svg/120px-Flag_of_Arizona.svg.png',
Â  Â  Â  Â  Â  Â  'Arkansas': 'https://upload.wikimedia.org/wikipedia/commons/thumb/9/9d/Flag_of_Arkansas.svg/120px-Flag_of_Arkansas.svg.png',
Â  Â  Â  Â  Â  Â  'California': 'https://upload.wikimedia.org/wikipedia/commons/thumb/0/01/Flag_of_California.svg/120px-Flag_of_California.svg.png',
Â  Â  Â  Â  Â  Â  'Colorado': 'https://upload.wikimedia.org/wikipedia/commons/thumb/4/46/Flag_of_Colorado.svg/120px-Flag_of_Colorado.svg.png',
Â  Â  Â  Â  Â  Â  'Connecticut': 'https://upload.wikimedia.org/wikipedia/commons/thumb/9/96/Flag_of_Connecticut.svg/120px-Flag_of_Connecticut.svg.png',
Â  Â  Â  Â  Â  Â  'Delaware': 'https://upload.wikimedia.org/wikipedia/commons/thumb/c/c6/Flag_of_Delaware.svg/120px-Flag_of_Delaware.svg.png',
Â  Â  Â  Â  Â  Â  'Florida': 'https://upload.wikimedia.org/wikipedia/commons/thumb/f/f7/Flag_of_Florida.svg/120px-Flag_of_Florida.svg.png',
Â  Â  Â  Â  Â  Â  'Georgia': 'https://upload.wikimedia.org/wikipedia/commons/thumb/5/54/Flag_of_Georgia_%28U.S._state%29.svg/120px-Flag_of_Georgia_%28U.S._state%29.svg.png',
Â  Â  Â  Â  Â  Â  'Hawaii': 'https://upload.wikimedia.org/wikipedia/commons/thumb/e/ef/Flag_of_Hawaii.svg/120px-Flag_of_Hawaii.svg.png',
Â  Â  Â  Â  Â  Â  'Idaho': 'https://upload.wikimedia.org/wikipedia/commons/thumb/a/a4/Flag_of_Idaho.svg/120px-Flag_of_Idaho.svg.png',
Â  Â  Â  Â  Â  Â  'Illinois': 'https://upload.wikimedia.org/wikipedia/commons/thumb/0/01/Flag_of_Illinois.svg/120px-Flag_of_Illinois.svg.png',
Â  Â  Â  Â  Â  Â  'Indiana': 'https://upload.wikimedia.org/wikipedia/commons/thumb/a/ac/Flag_of_Indiana.svg/120px-Flag_of_Indiana.svg.png',
Â  Â  Â  Â  Â  Â  'Iowa': 'https://upload.wikimedia.org/wikipedia/commons/thumb/a/aa/Flag_of_Iowa.svg/120px-Flag_of_Iowa.svg.png',
Â  Â  Â  Â  Â  Â  'Kansas': 'https://upload.wikimedia.org/wikipedia/commons/thumb/d/da/Flag_of_Kansas.svg/120px-Flag_of_Kansas.svg.png',
Â  Â  Â  Â  Â  Â  'Kentucky': 'https://upload.wikimedia.org/wikipedia/commons/thumb/8/8d/Flag_of_Kentucky.svg/120px-Flag_of_Kentucky.svg.png',
Â  Â  Â  Â  Â  Â  'Louisiana': 'https://upload.wikimedia.org/wikipedia/commons/thumb/e/e0/Flag_of_Louisiana.svg/120px-Flag_of_Louisiana.svg.png',
Â  Â  Â  Â  Â  Â  'Maine': 'https://upload.wikimedia.org/wikipedia/commons/thumb/3/35/Flag_of_Maine.svg/120px-Flag_of_Maine.svg.png',
Â  Â  Â  Â  Â  Â  'Maryland': 'https://upload.wikimedia.org/wikipedia/commons/thumb/a/a0/Flag_of_Maryland.svg/120px-Flag_of_Maryland.svg.png',
Â  Â  Â  Â  Â  Â  'Massachusetts': 'https://upload.wikimedia.org/wikipedia/commons/thumb/f/f2/Flag_of_Massachusetts.svg/120px-Flag_of_Massachusetts.svg.png',
Â  Â  Â  Â  Â  Â  'Michigan': 'https://upload.wikimedia.org/wikipedia/commons/thumb/b/b5/Flag_of_Michigan.svg/120px-Flag_of_Michigan.svg.png',
Â  Â  Â  Â  Â  Â  'Minnesota': 'https://upload.wikimedia.org/wikipedia/commons/thumb/b/b9/Flag_of_Minnesota.svg/120px-Flag_of_Minnesota.svg.png',
Â  Â  Â  Â  Â  Â  'Mississippi': 'https://upload.wikimedia.org/wikipedia/commons/thumb/4/42/Flag_of_Mississippi.svg/120px-Flag_of_Mississippi.svg.png',
Â  Â  Â  Â  Â  Â  'Missouri': 'https://upload.wikimedia.org/wikipedia/commons/thumb/5/5a/Flag_of_Missouri.svg/120px-Flag_of_Missouri.svg.png',
Â  Â  Â  Â  Â  Â  'Montana': 'https://upload.wikimedia.org/wikipedia/commons/thumb/c/cb/Flag_of_Montana.svg/120px-Flag_of_Montana.svg.png',
Â  Â  Â  Â  Â  Â  'Nebraska': 'https://upload.wikimedia.org/wikipedia/commons/thumb/4/4d/Flag_of_Nebraska.svg/120px-Flag_of_Nebraska.svg.png',
Â  Â  Â  Â  Â  Â  'Nevada': 'https://upload.wikimedia.org/wikipedia/commons/thumb/f/f1/Flag_of_Nevada.svg/120px-Flag_of_Nevada.svg.png',
Â  Â  Â  Â  Â  Â  'New Hampshire': 'https://upload.wikimedia.org/wikipedia/commons/thumb/2/28/Flag_of_New_Hampshire.svg/120px-Flag_of_New_Hampshire.svg.png',
Â  Â  Â  Â  Â  Â  'New Jersey': 'https://upload.wikimedia.org/wikipedia/commons/thumb/9/92/Flag_of_New_Jersey.svg/120px-Flag_of_New_Jersey.svg.png',
Â  Â  Â  Â  Â  Â  'New Mexico': 'https://upload.wikimedia.org/wikipedia/commons/thumb/c/c3/Flag_of_New_Mexico.svg/120px-Flag_of_New_Mexico.svg.png',
Â  Â  Â  Â  Â  Â  'New York': 'https://upload.wikimedia.org/wikipedia/commons/thumb/1/1a/Flag_of_New_York.svg/120px-Flag_of_New_York.svg.png',
Â  Â  Â  Â  Â  Â  'North Carolina': 'https://upload.wikimedia.org/wikipedia/commons/thumb/b/bb/Flag_of_North_Carolina.svg/120px-Flag_of_North_Carolina.svg.png',
Â  Â  Â  Â  Â  Â  'North Dakota': 'https://upload.wikimedia.org/wikipedia/commons/thumb/e/ee/Flag_of_North_Dakota.svg/120px-Flag_of_North_Dakota.svg.png',
Â  Â  Â  Â  Â  Â  'Ohio': 'https://upload.wikimedia.org/wikipedia/commons/thumb/4/4c/Flag_of_Ohio.svg/120px-Flag_of_Ohio.svg.png',
Â  Â  Â  Â  Â  Â  'Oklahoma': 'https://upload.wikimedia.org/wikipedia/commons/thumb/6/6e/Flag_of_Oklahoma.svg/120px-Flag_of_Oklahoma.svg.png',
Â  Â  Â  Â  Â  Â  'Oregon': 'https://upload.wikimedia.org/wikipedia/commons/thumb/b/b9/Flag_of_Oregon.svg/120px-Flag_of_Oregon.svg.png',
Â  Â  Â  Â  Â  Â  'Pennsylvania': 'https://upload.wikimedia.org/wikipedia/commons/thumb/f/f7/Flag_of_Pennsylvania.svg/120px-Flag_of_Pennsylvania.svg.png',
Â  Â  Â  Â  Â  Â  'Rhode Island': 'https://upload.wikimedia.org/wikipedia/commons/thumb/f/f3/Flag_of_Rhode_Island.svg/120px-Flag_of_Rhode_Island.svg.png',
Â  Â  Â  Â  Â  Â  'South Carolina': 'https://upload.wikimedia.org/wikipedia/commons/thumb/6/69/Flag_of_South_Carolina.svg/120px-Flag_of_South_Carolina.svg.png',
Â  Â  Â  Â  Â  Â  'South Dakota': 'https://upload.wikimedia.org/wikipedia/commons/thumb/1/1a/Flag_of_South_Dakota.svg/120px-Flag_of_South_Dakota.svg.png',
Â  Â  Â  Â  Â  Â  'Tennessee': 'https://upload.wikimedia.org/wikipedia/commons/thumb/9/9e/Flag_of_Tennessee.svg/120px-Flag_of_Tennessee.svg.png',
Â  Â  Â  Â  Â  Â  'Texas': 'https://upload.wikimedia.org/wikipedia/commons/thumb/f/f7/Flag_of_Texas.svg/120px-Flag_of_Texas.svg.png',
Â  Â  Â  Â  Â  Â  'Utah': 'https://upload.wikimedia.org/wikipedia/commons/thumb/f/f6/Flag_of_Utah.svg/120px-Flag_of_Utah.svg.png',
Â  Â  Â  Â  Â  Â  'Vermont': 'https://upload.wikimedia.org/wikipedia/commons/thumb/4/49/Flag_of_Vermont.svg/120px-Flag_of_Vermont.svg.png',
Â  Â  Â  Â  Â  Â  'Virginia': 'https://upload.wikimedia.org/wikipedia/commons/thumb/4/47/Flag_of_Virginia.svg/120px-Flag_of_Virginia.svg.png',
Â  Â  Â  Â  Â  Â  'Washington': 'https://upload.wikimedia.org/wikipedia/commons/thumb/5/54/Flag_of_Washington.svg/120px-Flag_of_Washington.svg.png',
Â  Â  Â  Â  Â  Â  'West Virginia': 'https://upload.wikimedia.org/wikipedia/commons/thumb/2/22/Flag_of_West_Virginia.svg/120px-Flag_of_West_Virginia.svg.png',
Â  Â  Â  Â  Â  Â  'Wisconsin': 'https://upload.wikimedia.org/wikipedia/commons/thumb/2/22/Flag_of_Wisconsin.svg/120px-Flag_of_Wisconsin.svg.png',
Â  Â  Â  Â  Â  Â  'Wyoming': 'https://upload.wikimedia.org/wikipedia/commons/thumb/b/bc/Flag_of_Wyoming.svg/120px-Flag_of_Wyoming.svg.png'
Â  Â  Â  Â  };

Â  Â  Â  Â  // Country flag API
Â  Â  Â  Â  function getCountryFlag(countryName) {
Â  Â  Â  Â  Â  Â  // Check if it's a US state first
Â  Â  Â  Â  Â  Â  if (stateFlags[countryName]) {
Â  Â  Â  Â  Â  Â  Â  Â  return stateFlags[countryName];
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  const countryToCode = {
Â  Â  Â  Â  Â  Â  Â  Â  'United States': 'us', 'China': 'cn', 'India': 'in', 'Brazil': 'br', 'Russia': 'ru',
Â  Â  Â  Â  Â  Â  Â  Â  'Japan': 'jp', 'Germany': 'de', 'United Kingdom': 'gb', 'France': 'fr', 'Italy': 'it',
Â  Â  Â  Â  Â  Â  Â  Â  'Canada': 'ca', 'South Korea': 'kr', 'Spain': 'es', 'Mexico': 'mx', 'Indonesia': 'id',
Â  Â  Â  Â  Â  Â  Â  Â  'Netherlands': 'nl', 'Saudi Arabia': 'sa', 'Turkey': 'tr', 'Switzerland': 'ch', 'Poland': 'pl',
Â  Â  Â  Â  Â  Â  Â  Â  'Belgium': 'be', 'Sweden': 'se', 'Argentina': 'ar', 'Norway': 'no', 'Austria': 'at',
Â  Â  Â  Â  Â  Â  Â  Â  'Ireland': 'ie', 'Israel': 'il', 'Nigeria': 'ng', 'Denmark': 'dk', 'Singapore': 'sg',
Â  Â  Â  Â  Â  Â  Â  Â  'Malaysia': 'my', 'South Africa': 'za', 'Philippines': 'ph', 'Colombia': 'co', 'Pakistan': 'pk',
Â  Â  Â  Â  Â  Â  Â  Â  'Chile': 'cl', 'Finland': 'fi', 'Bangladesh': 'bd', 'Egypt': 'eg', 'Vietnam': 'vn',
Â  Â  Â  Â  Â  Â  Â  Â  'Czech Republic': 'cz', 'Romania': 'ro', 'Portugal': 'pt', 'Peru': 'pe', 'Greece': 'gr',
Â  Â  Â  Â  Â  Â  Â  Â  'New Zealand': 'nz', 'Ukraine': 'ua', 'Hungary': 'hu', 'Kuwait': 'kw', 'Morocco': 'ma',
Â  Â  Â  Â  Â  Â  Â  Â  'Slovakia': 'sk', 'Ethiopia': 'et', 'Kenya': 'ke', 'Ecuador': 'ec', 'Puerto Rico': 'pr',
Â  Â  Â  Â  Â  Â  Â  Â  'Algeria': 'dz', 'Qatar': 'qa', 'Kazakhstan': 'kz', 'Dominican Republic': 'do',
Â  Â  Â  Â  Â  Â  Â  Â  'Guatemala': 'gt', 'Oman': 'om', 'Luxembourg': 'lu', 'Panama': 'pa', 'Bulgaria': 'bg',
Â  Â  Â  Â  Â  Â  Â  Â  'Croatia': 'hr', 'Ghana': 'gh', 'Uruguay': 'uy', 'Costa Rica': 'cr', 'Sri Lanka': 'lk',
Â  Â  Â  Â  Â  Â  Â  Â  'Lithuania': 'lt', 'Slovenia': 'si', 'Serbia': 'rs', 'Uzbekistan': 'uz', 'Myanmar': 'mm',
Â  Â  Â  Â  Â  Â  Â  Â  'Azerbaijan': 'az', 'Belarus': 'by', 'Tunisia': 'tn', 'Jordan': 'jo', 'Paraguay': 'py',
Â  Â  Â  Â  Â  Â  Â  Â  'Libya': 'ly', 'Bolivia': 'bo', 'Uganda': 'ug', 'Lebanon': 'lb', 'Cameroon': 'cm',
Â  Â  Â  Â  Â  Â  Â  Â  'Latvia': 'lv', 'Estonia': 'ee', 'Bahrain': 'bh', 'Nepal': 'np', 'Zambia': 'zm',
Â  Â  Â  Â  Â  Â  Â  Â  'Honduras': 'hn', 'Iceland': 'is', 'Senegal': 'sn', 'Cambodia': 'kh', 'Cyprus': 'cy',
Â  Â  Â  Â  Â  Â  Â  Â  'Zimbabwe': 'zw', 'Trinidad and Tobago': 'tt', 'El Salvador': 'sv', 'Bosnia and Herzegovina': 'ba',
Â  Â  Â  Â  Â  Â  Â  Â  'Afghanistan': 'af', 'Georgia': 'ge', 'Papua New Guinea': 'pg', 'Mali': 'ml',
Â  Â  Â  Â  Â  Â  Â  Â  'Albania': 'al', 'Malta': 'mt', 'Mozambique': 'mz', 'Botswana': 'bw', 'Gabon': 'ga',
Â  Â  Â  Â  Â  Â  Â  Â  'Jamaica': 'jm', 'Armenia': 'am', 'Mongolia': 'mn', 'Namibia': 'na', 'Brunei': 'bn',
Â  Â  Â  Â  Â  Â  Â  Â  'North Macedonia': 'mk', 'Madagascar': 'mg', 'Mauritius': 'mu', 'Nicaragua': 'ni',
Â  Â  Â  Â  Â  Â  Â  Â  'Moldova': 'md', 'Kosovo': 'xk', 'Chad': 'td', 'Rwanda': 'rw', 'Congo': 'cg',
Â  Â  Â  Â  Â  Â  Â  Â  'Laos': 'la', 'Kyrgyzstan': 'kg', 'Malawi': 'mw', 'Niger': 'ne', 'Haiti': 'ht',
Â  Â  Â  Â  Â  Â  Â  Â  'Tajikistan': 'tj', 'Benin': 'bj', 'Burkina Faso': 'bf', 'Mauritania': 'mr',
Â  Â  Â  Â  Â  Â  Â  Â  'Montenegro': 'me', 'Togo': 'tg', 'Fiji': 'fj', 'Barbados': 'bb', 'Eswatini': 'sz',
Â  Â  Â  Â  Â  Â  Â  Â  'Guyana': 'gy', 'Maldives': 'mv', 'Sierra Leone': 'sl', 'Suriname': 'sr',
Â  Â  Â  Â  Â  Â  Â  Â  'Somalia': 'so', 'Djibouti': 'dj', 'Burundi': 'bi', 'Belize': 'bz', 'Liberia': 'lr',
Â  Â  Â  Â  Â  Â  Â  Â  'Guinea': 'gn', 'Lesotho': 'ls', 'Timor-Leste': 'tl', 'Bahamas': 'bs',
Â  Â  Â  Â  Â  Â  Â  Â  'Equatorial Guinea': 'gq', 'Bhutan': 'bt', 'Solomon Islands': 'sb', 'Comoros': 'km',
Â  Â  Â  Â  Â  Â  Â  Â  'Cape Verde': 'cv', 'Sao Tome and Principe': 'st', 'Samoa': 'ws', 'Vanuatu': 'vu',
Â  Â  Â  Â  Â  Â  Â  Â  'Seychelles': 'sc', 'Antigua and Barbuda': 'ag', 'Andorra': 'ad', 'Grenada': 'gd',
Â  Â  Â  Â  Â  Â  Â  Â  'Tonga': 'to', 'Saint Lucia': 'lc', 'Kiribati': 'ki', 'Micronesia': 'fm',
Â  Â  Â  Â  Â  Â  Â  Â  'Saint Vincent and the Grenadines': 'vc', 'Dominica': 'dm', 'San Marino': 'sm',
Â  Â  Â  Â  Â  Â  Â  Â  'Liechtenstein': 'li', 'Monaco': 'mc', 'Palau': 'pw', 'Nauru': 'nr', 'Tuvalu': 'tv',
Â  Â  Â  Â  Â  Â  Â  Â  'Vatican City': 'va', 'Marshall Islands': 'mh', 'Saint Kitts and Nevis': 'kn',
Â  Â  Â  Â  Â  Â  Â  Â  'Australia': 'au', 'Angola': 'ao', 'Thailand': 'th', 'Tanzania': 'tz', 'Iraq': 'iq',
Â  Â  Â  Â  Â  Â  Â  Â  'Venezuela': 've', 'Iran': 'ir', 'Yemen': 'ye', 'Sudan': 'sd', 'Syria': 'sy',
Â  Â  Â  Â  Â  Â  Â  Â  'Eritrea': 'er', 'Central African Republic': 'cf', 'Guinea-Bissau': 'gw',
Â  Â  Â  Â  Â  Â  Â  Â  'Taiwan': 'tw', 'North Korea': 'kp', 'Cuba': 'cu', 'Turkmenistan': 'tm',
Â  Â  Â  Â  Â  Â  Â  Â  'Democratic Republic of the Congo': 'cd', 'South Sudan': 'ss', 'Gambia': 'gm',
Â  Â  Â  Â  Â  Â  Â  Â  'Western Sahara': 'eh', 'Palestine': 'ps', 'Greenland': 'gl', 'Hong Kong': 'hk',
Â  Â  Â  Â  Â  Â  Â  Â  'Macau': 'mo', 'Somaliland': 'so', 'Mayotte': 'yt', 'RÃ©union': 're'
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  const code = countryToCode[countryName];
Â  Â  Â  Â  Â  Â  if (code) {
Â  Â  Â  Â  Â  Â  Â  Â  return `https://flagcdn.com/w160/${code}.png`;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  return null;
Â  Â  Â  Â  }

Â  Â  Â  Â  // Initialize map with boundaries
Â  Â  Â  Â  function initMap() {
Â  Â  Â  Â  Â  Â  map = L.map('map', {
Â  Â  Â  Â  Â  Â  Â  Â  zoomControl: true,
Â  Â  Â  Â  Â  Â  Â  Â  attributionControl: false,
Â  Â  Â  Â  Â  Â  Â  Â  dragging: true,
Â  Â  Â  Â  Â  Â  Â  Â  scrollWheelZoom: true,
Â  Â  Â  Â  Â  Â  Â  Â  doubleClickZoom: true,
Â  Â  Â  Â  Â  Â  Â  Â  boxZoom: true,
Â  Â  Â  Â  Â  Â  Â  Â  keyboard: true,
Â  Â  Â  Â  Â  Â  Â  Â  minZoom: 2,
Â  Â  Â  Â  Â  Â  Â  Â  maxZoom: 8,
Â  Â  Â  Â  Â  Â  Â  Â  maxBounds: [[-90, -200], [90, 200]],
Â  Â  Â  Â  Â  Â  Â  Â  maxBoundsViscosity: 0.8,
Â  Â  Â  Â  Â  Â  Â  Â  preferCanvas: true,
Â  Â  Â  Â  Â  Â  Â  Â  renderer: L.canvas({ tolerance: 5 })
Â  Â  Â  Â  Â  Â  }).setView([20, 0], 2);
Â  Â  Â  Â  }

Â  Â  Â  Â  // Load GeoJSON data
Â  Â  Â  Â  async function loadMapData() {
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const worldResponse = await fetch('https://raw.githubusercontent.com/johan/world.geo.json/master/countries.geo.json');
Â  Â  Â  Â  Â  Â  Â  Â  const worldData = await worldResponse.json();
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const usResponse = await fetch('https://raw.githubusercontent.com/PublicaMundi/MappingAPI/master/data/geojson/us-states.json');
Â  Â  Â  Â  Â  Â  Â  Â  const usData = await usResponse.json();

Â  Â  Â  Â  Â  Â  Â  Â  // Process world countries (exclude USA)
Â  Â  Â  Â  Â  Â  Â  Â  worldData.features.forEach(feature => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let countryName = feature.properties.name;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Fix country names to English standard
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (countryName === 'Swaziland') countryName = 'Eswatini';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Skip USA and Somaliland (Somaliland will be added as a dot only)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (countryName &&Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  countryName !== 'United States of America' &&Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  countryName !== 'United States' &&
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  countryName !== 'Somaliland') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  gameState.regions.push({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  name: countryName,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: 'country',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  geometry: feature.geometry
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  // Process US states
Â  Â  Â  Â  Â  Â  Â  Â  usData.features.forEach(feature => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const stateName = feature.properties.name;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (stateName) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  gameState.regions.push({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  name: stateName,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: 'state',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  geometry: feature.geometry
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  // Draw regions on map
Â  Â  Â  Â  Â  Â  Â  Â  drawRegions(worldData, usData);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Add small countries and territories
Â  Â  Â  Â  Â  Â  Â  Â  addSmallRegions();

Â  Â  Â  Â  Â  Â  Â  Â  // Update total count
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('total-regions').textContent = gameState.regions.length;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  console.log(`Loaded ${gameState.regions.length} regions total`);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Fit bounds to show entire world
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  map.fitBounds([[-60, -180], [75, 180]], { padding: [10, 10] });
Â  Â  Â  Â  Â  Â  Â  Â  }, 100);

Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error('Error loading map data:', error);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function drawRegions(worldData, usData) {
Â  Â  Â  Â  Â  Â  // Draw world countries with improved rendering
Â  Â  Â  Â  Â  Â  L.geoJSON(worldData, {
Â  Â  Â  Â  Â  Â  Â  Â  filter: function(feature) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Completely exclude Somaliland from rendering
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return feature.properties.name !== 'Somaliland';
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  style: function(feature) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let countryName = feature.properties.name;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (countryName === 'Swaziland') countryName = 'Eswatini';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (countryName === 'United States of America' || countryName === 'United States') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fillOpacity: 0,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  opacity: 0,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  interactive: false
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fillColor: '#4CAF50',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fillOpacity: 1,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  color: 'white',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  weight: 1,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  interactive: true,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  smoothFactor: 0.5
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  onEachFeature: function(feature, layer) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let countryName = feature.properties.name;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (countryName === 'Swaziland') countryName = 'Eswatini';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (countryName === 'United States of America' || countryName === 'United States') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (countryName) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const isSmallCountry = smallCountries.find(c => c.name === countryName);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (isSmallCountry) return;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  regionLayers[countryName] = layer;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  layer.on('click', function(e) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  L.DomEvent.stopPropagation(e);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  handleRegionClick(countryName, e);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  layer.on('mouseover', function(e) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const target = e.target;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  target.setStyle({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fillOpacity: 0.5,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  weight: 2
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  layer.on('mouseout', function(e) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const target = e.target;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!target._path || !target._path.classList.contains('pulse-red-continuous')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  target.setStyle({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fillOpacity: 1,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  weight: 1
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (layer._path) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  layer._path.classList.add('region-path');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }).addTo(map);

Â  Â  Â  Â  Â  Â  // Draw US states with improved rendering
Â  Â  Â  Â  Â  Â  L.geoJSON(usData, {
Â  Â  Â  Â  Â  Â  Â  Â  style: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fillColor: '#4CAF50',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fillOpacity: 1,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  color: 'white',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  weight: 1,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  interactive: true,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  smoothFactor: 0.5
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  onEachFeature: function(feature, layer) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const stateName = feature.properties.name;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  regionLayers[stateName] = layer;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  layer.on('click', function(e) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  L.DomEvent.stopPropagation(e);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  handleRegionClick(stateName, e);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // FIXED HOVER - Direct style manipulation
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  layer.on('mouseover', function(e) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const target = e.target;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  target.setStyle({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fillOpacity: 0.5,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  weight: 2
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  layer.on('mouseout', function(e) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const target = e.target;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!target._path || !target._path.classList.contains('pulse-red-continuous')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  target.setStyle({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fillOpacity: 1,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  weight: 1
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (layer._path) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  layer._path.classList.add('region-path');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }).addTo(map);
Â  Â  Â  Â  }

Â  Â  Â  Â  function addSmallRegions() {
Â  Â  Â  Â  Â  Â  // Add very small countries as dots
Â  Â  Â  Â  Â  Â  smallCountries.forEach(country => {
Â  Â  Â  Â  Â  Â  Â  Â  const marker = L.circleMarker([country.lat, country.lng], {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  radius: 6,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fillColor: '#4CAF50',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  color: 'white',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  weight: 2,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  opacity: 1,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fillOpacity: 1
Â  Â  Â  Â  Â  Â  Â  Â  }).addTo(map);

Â  Â  Â  Â  Â  Â  Â  Â  smallCountryMarkers[country.name] = marker;

Â  Â  Â  Â  Â  Â  Â  Â  marker.on('click', function(e) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  L.DomEvent.stopPropagation(e);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  handleRegionClick(country.name, e);
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  marker.on('mouseover', function() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  marker.setStyle({ fillOpacity: 0.5 });
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  marker.on('mouseout', function() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!marker._path || !marker._path.classList.contains('pulse-red-continuous')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  marker.setStyle({ fillOpacity: 1 });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  gameState.regions.push({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  name: country.name,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: 'country',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isSmall: true
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  // Add territories as dots
Â  Â  Â  Â  Â  Â  territories.forEach(territory => {
Â  Â  Â  Â  Â  Â  Â  Â  const marker = L.circleMarker([territory.lat, territory.lng], {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  radius: 6,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fillColor: '#4CAF50',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  color: 'white',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  weight: 2,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  opacity: 1,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fillOpacity: 1
Â  Â  Â  Â  Â  Â  Â  Â  }).addTo(map);

Â  Â  Â  Â  Â  Â  Â  Â  smallCountryMarkers[territory.name] = marker;

Â  Â  Â  Â  Â  Â  Â  Â  marker.on('click', function(e) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  L.DomEvent.stopPropagation(e);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  handleRegionClick(territory.name, e);
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  marker.on('mouseover', function() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  marker.setStyle({ fillOpacity: 0.5 });
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  marker.on('mouseout', function() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!marker._path || !marker._path.classList.contains('pulse-red-continuous')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  marker.setStyle({ fillOpacity: 1 });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  gameState.regions.push({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  name: territory.name,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: 'territory',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isSmall: true
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  function startGame() {
Â  Â  Â  Â  Â  Â  gameState.started = true;
Â  Â  Â  Â  Â  Â  gameState.score = 0;
Â  Â  Â  Â  Â  Â  gameState.totalQuestions = 0;
Â  Â  Â  Â  Â  Â  gameState.correctAnswers = 0;
Â  Â  Â  Â  Â  Â  gameState.totalAttempts = 0;
Â  Â  Â  Â  Â  Â  gameState.processing = false;
Â  Â  Â  Â  Â  Â  gameState.remainingRegions = [...gameState.regions];
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  nextQuestion();
Â  Â  Â  Â  }

Â  Â  Â  Â  function nextQuestion() {
Â  Â  Â  Â  Â  Â  if (gameState.remainingRegions.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  endGame();
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // Stop any pulsing from previous question
Â  Â  Â  Â  Â  Â  if (gameState.pulsingLayer) {
Â  Â  Â  Â  Â  Â  Â  Â  if (gameState.pulsingLayer._path) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  gameState.pulsingLayer._path.classList.remove('pulse-red-continuous');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  gameState.pulsingLayer._path.style.fillOpacity = '1';
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  gameState.pulsingLayer = null;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  gameState.attempts = 0;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const randomIndex = Math.floor(Math.random() * gameState.remainingRegions.length);
Â  Â  Â  Â  Â  Â  gameState.currentQuestion = gameState.remainingRegions[randomIndex];
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Update UI
Â  Â  Â  Â  Â  Â  document.getElementById('country-name').textContent = gameState.currentQuestion.name;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Update flag
Â  Â  Â  Â  Â  Â  const flagUrl = getCountryFlag(gameState.currentQuestion.name);
Â  Â  Â  Â  Â  Â  const flagImg = document.getElementById('country-flag');
Â  Â  Â  Â  Â  Â  if (flagUrl) {
Â  Â  Â  Â  Â  Â  Â  Â  flagImg.src = flagUrl;
Â  Â  Â  Â  Â  Â  Â  Â  flagImg.style.display = 'block';
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  flagImg.style.display = 'none';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function showOnScreenFeedback(message, x, y) {
Â  Â  Â  Â  Â  Â  const feedback = document.getElementById('on-screen-feedback');
Â  Â  Â  Â  Â  Â  if (!feedback) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error('Feedback element not found!');
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  feedback.textContent = message;
Â  Â  Â  Â  Â  Â  feedback.style.left = x + 'px';
Â  Â  Â  Â  Â  Â  feedback.style.top = y + 'px';
Â  Â  Â  Â  Â  Â  feedback.style.display = 'block';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Force remove then add class
Â  Â  Â  Â  Â  Â  feedback.classList.remove('show');
Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  feedback.classList.add('show');
Â  Â  Â  Â  Â  Â  }, 10);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  feedback.classList.remove('show');
Â  Â  Â  Â  Â  Â  }, 2000);
Â  Â  Â  Â  }

Â  Â  Â  Â  function handleRegionClick(regionName, event) {
Â  Â  Â  Â  Â  Â  if (!gameState.started || !gameState.currentQuestion || gameState.processing) return;

Â  Â  Â  Â  Â  Â  // Get click coordinates - improved to work with all event types
Â  Â  Â  Â  Â  Â  let clickX, clickY;
Â  Â  Â  Â  Â  Â  if (event.originalEvent) {
Â  Â  Â  Â  Â  Â  Â  Â  clickX = event.originalEvent.clientX;
Â  Â  Â  Â  Â  Â  Â  Â  clickY = event.originalEvent.clientY;
Â  Â  Â  Â  Â  Â  } else if (event.containerPoint) {
Â  Â  Â  Â  Â  Â  Â  Â  clickX = event.containerPoint.x;
Â  Â  Â  Â  Â  Â  Â  Â  clickY = event.containerPoint.y;
Â  Â  Â  Â  Â  Â  } else if (event.latlng) {
Â  Â  Â  Â  Â  Â  Â  Â  const point = map.latLngToContainerPoint(event.latlng);
Â  Â  Â  Â  Â  Â  Â  Â  clickX = point.x;
Â  Â  Â  Â  Â  Â  Â  Â  clickY = point.y;
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  clickX = window.innerWidth / 2;
Â  Â  Â  Â  Â  Â  Â  Â  clickY = window.innerHeight / 2;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  gameState.totalAttempts++;
Â  Â  Â  Â  Â  Â  gameState.attempts++;

Â  Â  Â  Â  Â  Â  const layer = regionLayers[regionName];
Â  Â  Â  Â  Â  Â  const marker = smallCountryMarkers[regionName];
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  function flashRegion(color) {
Â  Â  Â  Â  Â  Â  Â  Â  if (layer && layer._path) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const className = `flash-${color}`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  layer._path.classList.add(className);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  layer._path.classList.remove(className);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }, 500);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (marker) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const flashColors = {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'white': '#FFFFFF',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'yellow': '#FFEB3B',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'orange': '#FF9800',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'red': '#f44336'
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const originalColor = marker.options.fillColor;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  marker.setStyle({Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fillColor: flashColors[color],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  radius: 10
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  marker.setStyle({Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fillColor: originalColor,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  radius: 6
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }, 500);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  if (regionName === gameState.currentQuestion.name) {
Â  Â  Â  Â  Â  Â  Â  Â  // Correct answer!
Â  Â  Â  Â  Â  Â  Â  Â  gameState.processing = true;
Â  Â  Â  Â  Â  Â  Â  Â  gameState.correctAnswers++;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Stop pulsing if it was happening
Â  Â  Â  Â  Â  Â  Â  Â  if (gameState.pulsingLayer && gameState.pulsingLayer._path) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  gameState.pulsingLayer._path.classList.remove('pulse-red-continuous');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  gameState.pulsingLayer._path.style.fillOpacity = '1';
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (gameState.attempts === 1) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  flashRegion('white');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  gameState.score += 3;
Â  Â  Â  Â  Â  Â  Â  Â  } else if (gameState.attempts === 2) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  flashRegion('yellow');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  gameState.score += 2;
Â  Â  Â  Â  Â  Â  Â  Â  } else if (gameState.attempts === 3) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  flashRegion('orange');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  gameState.score += 1;
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  flashRegion('red');
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  gameState.remainingRegions = gameState.remainingRegions.filter(r => r.name !== regionName);
Â  Â  Â  Â  Â  Â  Â  Â  gameState.totalQuestions++;

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('score-value').textContent = gameState.score;

Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  gameState.processing = false;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  nextQuestion();
Â  Â  Â  Â  Â  Â  Â  Â  }, 800);

Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  // Wrong answer - ALWAYS show country name at click position
Â  Â  Â  Â  Â  Â  Â  Â  console.log('Showing feedback:', regionName, 'at', clickX, clickY);
Â  Â  Â  Â  Â  Â  Â  Â  showOnScreenFeedback(regionName, clickX, clickY);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (gameState.attempts === 1) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  flashRegion('yellow');
Â  Â  Â  Â  Â  Â  Â  Â  } else if (gameState.attempts === 2) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  flashRegion('orange');
Â  Â  Â  Â  Â  Â  Â  Â  } else if (gameState.attempts >= 3) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  flashRegion('red');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Start continuous red pulsing on correct region
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const correctLayer = regionLayers[gameState.currentQuestion.name];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const correctMarker = smallCountryMarkers[gameState.currentQuestion.name];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (correctLayer && correctLayer._path) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  correctLayer._path.classList.add('pulse-red-continuous');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  gameState.pulsingLayer = correctLayer;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (correctMarker && correctMarker._path) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  correctMarker._path.classList.add('pulse-red-continuous');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  gameState.pulsingLayer = correctMarker;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function endGame() {
Â  Â  Â  Â  Â  Â  gameState.started = false;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Stop any pulsing
Â  Â  Â  Â  Â  Â  if (gameState.pulsingLayer && gameState.pulsingLayer._path) {
Â  Â  Â  Â  Â  Â  Â  Â  gameState.pulsingLayer._path.classList.remove('pulse-red-continuous');
Â  Â  Â  Â  Â  Â  Â  Â  gameState.pulsingLayer._path.style.fillOpacity = '1';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const accuracy = gameState.totalAttempts > 0 ? Math.round((gameState.correctAnswers / gameState.totalAttempts) * 100) : 0;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  document.getElementById('final-score').textContent = `${gameState.score} / ${gameState.totalQuestions * 3}`;
Â  Â  Â  Â  Â  Â  document.getElementById('accuracy').textContent = `${accuracy}%`;
Â  Â  Â  Â  Â  Â  document.getElementById('completion-screen').style.display = 'block';
Â  Â  Â  Â  }

Â  Â  Â  Â  // Event listeners
Â  Â  Â  Â  document.getElementById('question-container').addEventListener('click', function() {
Â  Â  Â  Â  Â  Â  if (!gameState.started) {
Â  Â  Â  Â  Â  Â  Â  Â  startGame();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  document.getElementById('restart-button').addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  document.getElementById('completion-screen').style.display = 'none';
Â  Â  Â  Â  Â  Â  document.getElementById('country-name').textContent = 'START GAME';
Â  Â  Â  Â  Â  Â  document.getElementById('country-flag').style.display = 'none';
Â  Â  Â  Â  Â  Â  document.getElementById('score-value').textContent = '0';
Â  Â  Â  Â  });

Â  Â  Â  Â  // Load map on page load
Â  Â  Â  Â  window.addEventListener('load', function() {
Â  Â  Â  Â  Â  Â  initMap();
Â  Â  Â  Â  Â  Â  loadMapData();
Â  Â  Â  Â  });
Â  Â  </script>
</body>
</html>
